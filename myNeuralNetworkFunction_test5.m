function [Y,Xf,Af] = myNeuralNetworkFunction_test5(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 20-Jan-2019 15:36:51.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 100xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 4xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100];
x1_step2.xoffset = [0.000792119509447198;0.00158500453920186;0.00237780597478173;0.00317052703560039;0.00396316759456685;0.00475572774379314;0.00554820740621455;0.00634060667518754;0.00713292547369274;0.00792516389506842;0.00871732186231085;0.00950939946873935;0.0103013966373658;0.0110933134614907;0.0118851498641414;0.0126769059385995;0.0134685816079081;0.0142601769653297;0.015051691933923;0.0158431266069317;0.0166344809074302;0.0174257549286431;0.0182169485936604;0.0190080619956878;0.019799095057831;0.0205900478732767;0.0213809203651463;0.0221717126266076;0.0229624245807973;0.0237530563208646;0.0245436077699618;0.0253340790212191;0.0261244699978044;0.0269147807928289;0.0277050113294763;0.0284951617008388;0.0292852318301157;0.0300752218103802;0.0308651315648473;0.0316549611865715;0.032444710598783;0.0332343798945175;0.0340239689970211;0.0348134779993103;0.0356029068246467;0.0363922555660283;0.0371815241467321;0.037970712659737;0.0387598210283358;-1.11909237183259;-6.75503970183397;-5.95079947809646;-7.69075784969228;-7.0216510863854;-6.77685060468246;-6.22337859126694;-5.5922244524504;-5.64042468498546;-6.83460114734233;-7.57717248100847;-7.04348726568631;-7.74513209323025;-7.85111424658966;-7.80444473085847;-7.03187789614599;-5.70460411966514;-4.27410792732011;-4.88592490784006;-5.39901334475678;-6.5038704180769;-7.28735820908603;-7.7490551368339;-7.89986919154365;-7.76070119486632;-7.36086865302996;-6.73636804455306;-6.70094290337669;-6.71466856198772;-6.55710781117575;-6.24022460072773;-5.77947590183562;-5.3806079835;-4.87550177684073;-4.28116369051775;-4.76269691437206;-5.40899594292357;-5.95529498358742;-6.40184205830531;-6.74996759396801;-7.00200202599614;-7.16118752368207;-7.23158523237045;-7.21797928878451;-7.12577890339777;-6.96091968295409;-6.72976534310452;-6.52625902943737;-6.45305791308824];
x1_step2.gain = [0.176738585225335;0.156929245542784;0.164444403681595;0.147434542201489;0.150086509519561;0.139052400264107;0.140343431897471;0.140390882476141;0.141048815030403;0.140684036063446;0.147328048162957;0.151851230733527;0.148486450024114;0.147869377311087;0.146943342543762;0.148764617024211;0.14861609422317;0.149165181523808;0.151791601783486;0.156546187361481;0.159003584888087;0.161846830918471;0.165005708045183;0.165221484844801;0.17445160339972;0.171895758729074;0.166947295427477;0.162853340205247;0.159530080857239;0.156910332923228;0.154940739932347;0.153579614709617;0.152795273031531;0.152564750265939;0.152872818469886;0.15371124180932;0.155078221541759;0.156977992163296;0.159420536134502;0.162421388721205;0.166001504999461;0.170187160044358;0.171477801254473;0.170539920023471;0.169902436823658;0.169553622879773;0.169483672981075;0.169684492014066;0.170149507793253;0.0514399717707509;0.0413216323564369;0.0426638316534557;0.0440382572587683;0.047421750698249;0.0501337094419871;0.0530483762216845;0.0565530182603978;0.0587711261024107;0.057952221227524;0.0583511011051459;0.0614023077554475;0.0625514417645017;0.0648433892943291;0.065193534062465;0.0674810015459884;0.0716576678401847;0.0770359576947871;0.0770647242968933;0.0776572335396171;0.0767119550582826;0.0769122974048795;0.078241607509955;0.0807488551401879;0.0845529729926379;0.0865598724253937;0.0894444521536303;0.090230974700357;0.0909802159122581;0.0926171312597788;0.0951754749138022;0.0987217021582401;0.102366853837885;0.107045780861188;0.112891597805119;0.112345174067358;0.110907638387607;0.110219655638891;0.110240337242322;0.110950380440262;0.112350091482942;0.114458772440812;0.117315354385517;0.120980314616509;0.1255390721904;0.131107247665755;0.137838438949596;0.145012376633507;0.151453591274925];
x1_step2.ymin = -1;

% Layer 1
b1 = [0.59272532271799727166;0.706787050005554085;1.1452598675588676613;5.5730044331140957681];
IW1_1 = [2.6313709474269555422 -1.3697523087937126807 0.31989151390169257017 0.40566173902434643495 -0.27046985915501459141 0.30213515653187050791 0.69510087153214938915 0.4309805250392557685 -0.065350891366825744622 -0.13189223432042926354 -0.03638362620877821918 0.44721945431123055759 0.43964583594846107228 0.11932893439395092505 -0.12282155620591103662 0.097933979970211526567 0.074467156223912020496 -0.11812839088140644761 0.10754430021661938455 0.029533542668086568139 0.073515255864305129041 0.21490975441858889416 0.042132855043588518518 0.42066111392145272285 0.093389500009304987627 -0.10351187384450415141 -0.38824128709821204009 -0.46261134787394397883 -0.35641217809604675004 -0.32913465946680814378 -0.024123851658002185699 -0.081280924977140012189 -0.11531265173216362352 -0.29444199428694395326 -0.22940378327519977963 -0.38070980348415939254 -0.021713068500709926945 -0.12027922333498823615 -0.28395408538916161456 -0.42087471585694585796 -0.34005307396866801817 -0.38951566576989415935 -0.31077918248358793463 -0.19175069846668740814 0.00061628248115859268416 -0.014538981322069051416 0.67144292266575222872 0.61995540204129107043 1.2933772517842618832 0.71799367015519743873 -0.20980436619706016588 0.1388234404417111878 -0.063642662359387897064 0.030432727173538464543 -0.012568338952877469716 -0.14555117021895880303 -0.57246853400994246464 -0.66557838443921679694 -0.36880655220914493331 -0.34203487636387136517 -0.3621528155575033936 -0.17419528466103870179 -0.44121150389430779937 -0.073768760926626764096 -0.1154208917643099741 -0.12395390229125630155 -0.00068444323876253043704 -0.012524150971519161513 -0.086946889348798267472 -0.24627152807015423308 -0.13270523287868862816 -0.25538013396354763973 0.14244674134747312144 -0.022634630497654961712 -0.093926552108868605062 0.16241632997595012444 0.18459875852585708178 0.38816474855782867603 0.039680194246677943926 0.46608645368828921507 0.039889666688855116017 0.20348785802096827635 0.2263755819471648667 0.4107453521392234741 -0.13314311261424377486 -0.14848456764231190985 -0.096956480826227181558 -0.37966575182086981233 -0.33530807740203438794 -0.47122640924978431709 -0.1244786008946704714 -0.23710839075124978681 -0.31708467744299906332 -0.47640296745552335178 0.12645541852477509837 -0.28116456721234267535 -0.29066653283021165466 0.0069774353236517899779;-0.31746988400949111009 -0.9057422896195539419 0.36163068247189628091 0.35012272245365172463 -0.3037104145170453906 -0.76118178426487070887 0.014949346673171902411 -0.029051931012070306148 -0.50897824252464030081 -0.14969752737492136863 0.15078314525054659079 -0.073213005351533758103 -0.27508758456109078105 -0.26223705583816681042 -0.50492369476680343254 -0.049764271402176714354 0.29398443924635603297 0.043108085688037853234 -0.24918264435230069731 -0.03449372540936316428 -0.50162068966686867988 -0.30213885540266705032 -0.22099287230477526744 -0.14348853735037239709 0.054090553428627077825 0.020540111694854475827 0.09834513889081586413 0.10806155829545516234 0.2028546787081555447 0.023057728054283754132 -0.045659459795834911322 -0.011352579618569801079 0.11729312120106333284 0.047990239154589067749 0.12228919990643902227 0.32827376568738381168 -0.11381832602768865437 0.016419113841633414808 -0.11580198943519370847 0.16620153124273315259 0.26965543925834428718 0.07351544834029526132 0.18028514901555928174 0.086679583040863969479 -0.035819730080728362509 -0.30227579720737601798 -0.34350162007837925504 -0.91624553622860149815 -1.3325265197995845856 -1.1195351702041458353 0.5632743691395636354 -0.44269130132705164504 0.14192170742406740036 -0.33904878002520894009 0.15536150779416421641 0.41075094658455030272 0.55451762830491380107 0.44549961225951750787 0.61583902463868711585 0.47741481561740922723 0.23053720025173343733 0.38116961980775465602 0.23777001791566090838 0.44393985832586169149 0.31584674583250682556 0.37387036449376320757 0.053049960326493138252 0.17400053961765829524 0.082458580891514268729 0.015526252135283968858 -0.088145726078514896606 0.091155343112381451154 0.036663821042522803939 0.12482186211473980664 -0.017397553194154913997 -0.029538242533563727199 -0.44222011603785821299 -0.14644674735340348914 -0.25932398417493757181 -0.15676017327133334733 -0.57637667648879653548 -0.54855896477567400726 -0.28558390348684448146 -0.3793525727751423382 -0.29919394517519742882 -0.15538891365938939382 0.18135396320468563647 0.048763129021880791125 0.39214149337517567595 0.11385357177065082157 0.28553424578959418767 0.16656008077298084524 0.39841893196399941202 -0.033029719243565680564 -0.13226334454983040834 -0.34023918200881519969 -0.33043412345981704181 -0.51445639420590760782;-0.53557134657588767457 1.3373515273096368006 -0.39451648392871752069 0.4840883795648092125 -0.61670273928087704363 0.035757674622250060215 -0.35695824886831162281 0.27159999822974895123 -0.10624757702950150817 -0.09541387339912940635 -0.13486970696015179727 -0.024175516522155313104 0.07423688872130998484 0.062501893884454595707 -0.15262476551660272839 -0.060148881801460198082 -0.078216443025098447706 0.028208394802958520337 0.1519956225379048842 0.21279183729799142077 0.21596454359132769008 0.018704856501246841516 0.012923742102257967934 -0.10259766383486526586 0.090950324649256841791 -0.30694912001048352268 0.0056875019011483236853 0.10927195185292550017 0.1171683365283525402 0.26149880910894046648 -0.14245810943001127602 0.076944853570183519009 -0.045555964314221070177 -0.30135127261246713593 -0.01542701154359521834 -0.044506094632718741499 0.21794571235438700563 0.29366545655792547498 0.15457644295644920596 0.10688420638635762194 0.12114357003327259898 -0.26991546397343463282 0.036690705739071634295 -0.10117013647651382224 -0.13320707134068698885 -0.015647465218495373862 0.2862360675186049197 0.30260178875871668325 0.29985500481714727483 -0.68963095587086853389 0.041032667311497052209 1.2984541293861660005 -1.1654961818776132798 -0.16709065263186254069 -0.29598053068656071662 0.14311347295547865999 0.71576661711763311935 0.18165360234094390934 0.035980354143259077326 -0.29740417327881218945 0.056171571740691414454 -0.31740604086014301277 0.16552267463709985362 0.32357285773348198887 0.07587968923809063071 -0.016649296463989122358 0.097520376941792344394 -0.17479687603805685314 -0.1316103396870973441 -0.13384424443667933269 0.31390350381102749555 0.090034112409737215854 -0.010475430259110608822 0.27255478255987392044 0.19628287631041069217 -0.15952361834331971191 -0.16838306687333987055 -0.33952291367491443941 -0.067241492504358846283 -0.1599591361704503778 -0.050141301777602710621 -0.12748654609656145942 -0.05169285923592450982 -0.35822462132853627459 -0.060121000454983725136 0.055138816612147228957 -0.11995297339443303231 0.0065004956806901971478 0.074473877088710838112 0.15289166697926287464 -0.23688071559976325853 -0.41215405451629255618 -0.26790066019552444265 -0.00056020769994272190395 -0.21533826907764375136 0.35683528927567370603 0.56445926316803751721 1.0428655983401933227;4.7664147457608407876 -3.808506939528664148 0.45599105007166940151 1.2545680236904053206 -0.10477619284743905359 -0.41097369228914060191 0.2286289828687879111 0.15572728665301904805 -0.096951309338793284498 -0.82725069031228826155 0.11989720483885721314 0.4370074924131067684 0.54909826709278464207 -0.028917307779226124331 -0.72911546535249849299 -0.43537257533697482081 0.0071070753297063846143 0.32592182039074502065 0.58331021913042213622 -0.13590219497665897985 -0.086131224299693581736 -0.21443896845607524071 0.024276928877049359923 -0.027563919784072590802 0.18318296980618872793 -0.071445036900093614185 0.066942649133933523897 -0.073777079550767274418 -0.073707426235136999648 0.010705846687722795144 -0.32998074285666134653 -0.095494874022348325004 0.16920080219645786124 0.082982116770785707693 -0.12884046258152762054 0.067612068634226987762 0.22803780057526412683 -0.1891681674430157889 -0.065274664654449018886 0.1118570948065233106 0.085409177061828878141 0.20173499315211240734 -0.33664869080327997075 -0.034496621158130791329 0.085886749298422659926 -0.053747944483275467142 0.15241159214468369409 0.27174321459057737549 0.3653664419040043021 4.526943779177023508 -2.852332623348007079 -0.7702243918094353603 0.37330062522704765549 0.17932559211550330724 0.63661808966473742988 0.49788168843592439661 -0.32622395700264855689 -0.25667121069338494355 0.32157259824505313173 0.54896932145745069853 0.083394309132294355824 -0.048036831280586958504 -0.22970435569333264025 0.013221057101322132576 0.04530644114047040899 0.29588220685836458257 -0.035243460718419244992 -0.1040162045742572261 -0.19585993735047765862 -0.15661819052823860998 0.10649028258839456085 0.099925430638951429074 0.28249426699718754863 0.014316803026742135757 -0.09158856563426177877 -0.037977455425252229504 0.09279903775072959049 0.26567952521133980648 -0.079583619344771427961 -0.070229268302401962054 -0.057015710645253465938 -0.164198272598991446 -0.36700097551925298101 -0.36408058748128391269 0.12580379791316381732 0.36331478401934225175 0.036882108571123312091 0.29946602706137664951 -0.055114692202261686416 -0.42229036181462925592 -0.26906674303375549551 -0.25366660204689484015 -0.12338865760999422061 -0.26358291749030043905 -0.069570434532498545699 0.17380067892562800491 0.40818068053035183596 0.70049668758360372767];

% Layer 2
b2 = [-0.24029792996058493837;3.142426946634463647;-0.17418802480404965705;2.1478675193487926087];
LW2_1 = [2.1832061180478454787 2.2469565127936954596 0.71453561919324826146 -1.2056794467285913974;-4.3863316818893682836 -4.3333482337240765148 6.2230103246356822666 -9.1029184220998580201;0.11306922033489652524 0.12049262177838809817 -0.004964219475597497766 0.17684916924932408966;-2.5811743337509946983 -2.0104802669016446082 -5.2105429102888169979 2.92376316013455817];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [2.00087110188028;2.00518320445287;2.0031561944056;2.00250526511533];
y1_step1.xoffset = [8.81941434118794e-05;0.000352432056340057;0.000245930698326013;0.000908227895756286];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
